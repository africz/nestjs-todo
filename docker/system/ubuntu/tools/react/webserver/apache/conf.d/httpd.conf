<VirtualHost *:80>
    ServerAdmin attila.fricz@gmail.com
    ServerName ${DOMAIN}
    DocumentRoot /var/www/html/public
    #always was the key to get it working with url parameters
    Header always set Access-Control-Allow-Credentials true
    #without these list/?page=2 cors blocked
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "POST, GET, OPTIONS, DELETE, PUT"
    Header always set Access-Control-Max-Age "1000"
    Header always set Access-Control-Allow-Headers "x-requested-with, Content-Type, origin, authorization, accept, client-security-token"

    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]

    <Directory /var/www/html/public>
    Options Indexes MultiViews FollowSymLinks
    AllowOverride All
    Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
    <FilesMatch \.php$>
        # 2.4.10+ can proxy to unix socket
        #SetHandler "proxy:unix: /run/php/php8.2-fpm.sock|fcgi://localhost/"
        # Else we can just use a tcp socket:
        CGIPassAuth On
        SetHandler "proxy:fcgi://php:9000"
    </FilesMatch>
</VirtualHost>

<IfModule mod_ssl.c>
    <VirtualHost _default_:443>
        ServerName ${DOMAIN}
        ServerAdmin attila.fricz@gmail.com
 
        DocumentRoot /var/www/html/public
 
        <Directory "/var/www/html">
            Order allow,deny
            Allow from all
            AllowOverride all
            Require all granted
        </Directory>
 
        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined
 
        SSLEngine on
 
        SSLCertificateFile  /ssl-certs/cert.pem
        SSLCertificateKeyFile /ssl-certs/key.pem
 
        <FilesMatch "\.(cgi|shtml|phtml|php)$">
                SSLOptions +StdEnvVars
        </FilesMatch>
        <Directory /usr/lib/cgi-bin>
                SSLOptions +StdEnvVars
        </Directory>
        
        <FilesMatch \.php$>
        # 2.4.10+ can proxy to unix socket
        #SetHandler "proxy:unix: /run/php/php8.2-fpm.sock|fcgi://localhost/"
        # Else we can just use a tcp socket:
        SetHandler "proxy:fcgi://php:9000"
        </FilesMatch>        
    </VirtualHost>
</IfModule>
server {
	listen 443 ssl http2;
	server_name _;

	root /var/www/html/public;
	index index.php index.html index.htm;

	ssl_certificate /ssl-certs/cert.pem;
	ssl_certificate_key /ssl-certs/key.pem;


	add_header Access-Control-Allow-Credentials true;
	add_header Access-Control-Allow-Methods "POST, GET, OPTIONS, DELETE, PUT";
	add_header Access-Control-Max-Age "1000";
	add_header Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With";

	location / {
		if ($request_method = 'OPTIONS') {
			add_header 'Access-Control-Allow-Origin' "$http_origin";
			add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE';
			add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization, X-Requested-With';
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Max-Age' 1728000;
			add_header 'Content-Type' 'text/plain; charset=utf-8';
			add_header 'Content-Length' 0;
			return 204;
		}
		try_files $uri $uri/ /index.php?$query_string;
	}
	
	# pass PHP scripts on Nginx to FastCGI (PHP-FPM) server
	set $cors_origin "";
	set $cors_cred   "";
	set $cors_header "";
	set $cors_method "";

	if ($http_origin ~* "^https?://(laravel-multi-template\.localhost|laravel-node-multi-template\.localhost|.*\.your-other-domain\.com)$") {
			set $cors_origin $http_origin;
			set $cors_cred   true;
			set $cors_header $http_access_control_request_headers;
			set $cors_method $http_access_control_request_method;
	}

	# add headers only when origin matched, ensure they are always included
	add_header Access-Control-Allow-Origin      $cors_origin always;
	add_header Access-Control-Allow-Credentials $cors_cred always;
	add_header Access-Control-Allow-Headers     $cors_header always;
	add_header Access-Control-Allow-Methods     $cors_method always;

	# remove or keep the following unconditional add_header lines if desired

	location ~ \.php$ {
		include fastcgi_params;
		fastcgi_pass php:9000;
		fastcgi_index index.php;
		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
	}

	location ~ /\.ht {
		deny all;
	}
}
server {
	listen 80;
	server_name _;
	root /var/www/html/public;
	index index.php index.html index.htm;


	add_header Access-Control-Allow-Credentials true;
	add_header Access-Control-Allow-Methods "POST, GET, OPTIONS, DELETE, PUT";
	add_header Access-Control-Max-Age "1000";
	add_header Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With";

	location / {
	# For OPTIONS pre-flight requests
	if ($request_method = 'OPTIONS') {
		add_header 'Access-Control-Allow-Origin' "$http_origin";
		add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE';
		add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization, X-Requested-With';
		add_header 'Access-Control-Allow-Credentials' 'true';
		add_header 'Access-Control-Max-Age' 1728000;
		add_header 'Content-Type' 'text/plain; charset=utf-8';
		add_header 'Content-Length' 0;
		return 204;
	}
		try_files $uri $uri/ /index.php?$query_string;
	}
    # pass PHP scripts on Nginx to FastCGI (PHP-FPM) server
    set $cors_origin "";
    set $cors_cred   "";
    set $cors_header "";
	set $cors_method "";

	if ($http_origin ~* "^http?://(laravel-multi-template\.localhost|laravel-node-multi-template\.localhost|.*\.your-other-domain\.com)$") {
			set $cors_origin $http_origin;
			set $cors_cred   true;
			set $cors_header $http_access_control_request_headers;
			set $cors_method $http_access_control_request_method;
	}

	# add headers only when origin matched, ensure they are always included
	add_header Access-Control-Allow-Origin      $cors_origin always;
	add_header Access-Control-Allow-Credentials $cors_cred always;
	add_header Access-Control-Allow-Headers     $cors_header always;
	add_header Access-Control-Allow-Methods     $cors_method always;

	# remove or keep the following unconditional add_header lines if desired
	
	location ~ \.php$ {
		include fastcgi_params;
		fastcgi_pass php:9000;
		fastcgi_index index.php;
		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
	}

	location ~ /\.ht {
		deny all;
	}
}
